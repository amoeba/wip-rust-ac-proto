AC NETWORK PROTOCOL - MESSAGE STRUCTURE
========================================

OVERVIEW
--------
The Asheron's Call network protocol uses a two-level message structure for certain message types,
with ordered messages wrapped in a delivery/ordering envelope.

ORDERED VS NON-ORDERED MESSAGES
-------------------------------

There are two classes of messages:

1. ORDERED MESSAGES (0xF7B0 and 0xF7B1)
   - Require reliable message delivery with ordering guarantees
   - Wrapped in an Ordered_GameEvent or Ordered_GameAction envelope
   - Used for gameplay events that must arrive in sequence

2. NON-ORDERED MESSAGES
   - Regular game messages with direct opcodes
   - No wrapper, message payload follows directly from opcode
   - Can be lost or arrive out of order without protocol impact


ORDERED MESSAGE STRUCTURE (0xF7B0 / 0xF7B1)
-------------------------------------------

Wire Format:
  Opcode: 0xF7B0 (Server→Client) or 0xF7B1 (Client→Server)
  
  Packet Layout:
  ┌─────────────────────────────────────────┐
  │ Ordered_GameEvent / Ordered_GameAction  │
  ├─────────────────────────────────────────┤
  │ OrderedObjectId (uint32, little-endian) │
  │ OrderedSequence (uint32, little-endian) │
  │ EventType (uint32, little-endian)       │
  │ [Message Payload - variable length]     │
  └─────────────────────────────────────────┘

Fields:
  - OrderedObjectId: The object ID this message applies to
  - OrderedSequence: Sequence number for ordering/acknowledgment
  - EventType: The actual message opcode (e.g., 0x00C9 for Item_SetAppraiseInfo)
  - Message Payload: The serialized message fields


EXAMPLE: Item_SetAppraiseInfo (0x00C9)
--------------------------------------

When received as an ordered message:
  Wire Opcode: 0xF7B0 (Ordered_GameEvent)
  Message ID: 0x00C9 (EventType field)
  Filename: 0001_ServerToClient_0xF7B0_0x00C9_Item_SetAppraiseInfo.bin

Deserialization Order:
  1. Read as Ordered_GameEvent wrapper
  2. Extract OrderedObjectId, OrderedSequence
  3. Read EventType (0x00C9) to identify the message type
  4. Deserialize remaining payload as Item_SetAppraiseInfo


NON-ORDERED MESSAGE STRUCTURE
-----------------------------

Wire Format:
  Opcode: Direct message ID (e.g., 0xF7B1 for Item_Appraise)
  
  Packet Layout:
  ┌──────────────────────────────────┐
  │ Message Opcode                   │
  │ [Message Payload - var length]   │
  └──────────────────────────────────┘

No wrapper, no ordering information.


MESSAGE ROUTING
---------------

Ordered Messages (0xF7B0 / 0xF7B1) are used for:
  - Server→Client game events (0xF7B0)
    Examples: Magic_UpdateEnchantment, Item_SetAppraiseInfo, etc.
  - Client→Server game actions (0xF7B1)
    Examples: Item_Appraise, Combat actions, etc.

Non-Ordered Messages are used for:
  - Direct message types with their own opcodes
  - Server status messages
  - Authentication and connection control
  - World state updates that don't require ordering


IMPLEMENTATION NOTES
--------------------

When Deserializing:
  1. Read the wire opcode (first 2-4 bytes)
  2. If opcode is 0xF7B0 or 0xF7B1:
     a. Deserialize as Ordered_GameEvent or Ordered_GameAction
     b. This automatically extracts and deserializes the nested message
     c. Access inner message type via EventType field
  3. If opcode is anything else:
     a. Look up the message type for that opcode
     b. Deserialize directly as that message type

When Serializing:
  1. For ordered messages:
     a. Create an Ordered_GameEvent/GameAction wrapper
     b. Set the OrderedObjectId and OrderedSequence
     c. Set EventType to the message ID
     d. Serialize the message payload
     e. Write the entire wrapper
  2. For non-ordered messages:
     a. Write the opcode
     b. Write the message payload


FILE NAMING CONVENTION
----------------------

Format: {index}_{direction}_{wireOpcode}_{messageId}_{messageName}.bin

Examples:
  0001_ServerToClient_0xF7B0_0x00C9_Item_SetAppraiseInfo.bin
    - Wire opcode: 0xF7B0 (Ordered_GameEvent)
    - Message ID: 0x00C9 (Item_SetAppraiseInfo)
  
  0000_ClientToServer_0xF7B1_0xF7B1_Item_Appraise.bin
    - Wire opcode: 0xF7B1 (Ordered_GameAction)
    - Message ID: 0xF7B1 (same as wire - non-ordered)


ENUM REFERENCES
---------------

For GameEvent messages (0xF7B0):
  - Use GameEventType enum from Chorizite.ACProtocol.Enums
  - Contains all possible EventType values and their names

For GameAction messages (0xF7B1):
  - Also uses GameEventType enum
  - Contains all possible action types

For other opcodes:
  - Use C2SMessage enum for client-to-server
  - Use S2CMessage enum for server-to-client
